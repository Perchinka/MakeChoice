# `src/domain/`

## Что делает этот слой
- **Entities (сущности)**  
  Описывают основные объекты нашей предметной области, просто какие данные хранятся и как с ними взаимодействовать. Упрощает читабельность кода, да и дебажить проще, когда знаешь, что функция должна возвращать:
  - `User` — пользователь системы.  
  - `Course` — курс-электив.  
  - `Choice` — выбор курса студентом (один {приоритет:id_курса:id_студента}).

- **Repositories** 
  Абстракции (интерфейсы) для операций создания, чтения, обновления и удаления (`CRUD`).  
  Они не содержат кода SQL/ORM — только сигнатуры методов, чтобы можно было легче поменять фреймворк если захочется, да и suggestion-ы удобно:
  ```python
  class AbstractCourseRepository(ABC):
      def add(self, course: Course) -> None: ...
      def get(self, course_id: UUID) -> Optional[Course]: ...
      def list(self) -> List[Course]: ...
      ...

- **Unit of Work (UoW)**
Паттерн, гарантирующий атомарность и консистентность операций:
    - __enter__ начинает транзакцию.
    - сервис выполняет какие-то операций над репозиториями. (Пишет что-то в бд)
    - __exit__ автоматически коммитит изменения, если не было исключений, или откатывает их при ошибке.

    Крутая штука чтобы иметь, т.к. позволяет не париться, если ошибка возникает посреди записи в бд.
    как юзать можешь глянуть в сервисах

- **Exceptions (исключения)**
Кастомные ошибки, чтобы можно было лего их отлавливать и конвертировать в http. FastAPI это делает автоматом, но тебе если новые будешь добавлять - не забудь обновить api/error_handler

Домен не знает ничего про sso, бд и апи. Он знает про то, как **логически** работает система. Какие методы есть у адаптеров в внешний мир и как они между собой взаимосвязаны, но не знает их конкретную реализацию. Домену все равно какую ты технологию используешь. Для бд например ты можешь переключиться на sqlite и не менять ни сервисы, ни доменые модели. Они остануться точно такими же, и все изменения будут лишь в инфраструктуре
